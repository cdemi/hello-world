image:
- Ubuntu
- Visual Studio 2017

services:
- docker

before_build:
- pwsh: |
    $env:DOCKER_TAG="$ENV:APPVEYOR_BUILD_VERSION"
    if ($isLinux) {
      $env:DOCKER_TAG="$env:DOCKER_TAG-linux"
    } else {
      $env:DOCKER_TAG="$env:DOCKER_TAG-windows"
    }

build_script:
- pwsh: docker login -u "$ENV:DOCKER_USERNAME" -p "$ENV:DOCKER_PASSWORD"
- pwsh: docker build -t cdemi/hello-world:$ENV:DOCKER_TAG .
- pwsh: docker run --rm cdemi/hello-world:$ENV:DOCKER_TAG
- pwsh: docker push cdemi/hello-world:$ENV:DOCKER_TAG